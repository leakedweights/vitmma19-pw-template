<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Text Understandability Analyzer</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- JetBrains Mono Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            font-family: 'JetBrains Mono', monospace;
        }
        .prediction-bar {
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-white min-h-screen text-neutral-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Monochrome bar colors - just darker shades for higher difficulty
        const LABEL_COLORS = {
            "1-Nagyon nehezen érthető": "bg-neutral-900",
            "2-Nehezen érthető": "bg-neutral-700",
            "3-Többé/kevésbé megértem": "bg-neutral-500",
            "4-Érthető": "bg-neutral-400",
            "5-Könnyen érthető": "bg-neutral-300",
        };
        
        const LABEL_SHORT = {
            "1-Nagyon nehezen érthető": "1 - Very Hard",
            "2-Nehezen érthető": "2 - Hard",
            "3-Többé/kevésbé megértem": "3 - Medium",
            "4-Érthető": "4 - Easy",
            "5-Könnyen érthető": "5 - Very Easy",
        };

        function App() {
            const [text, setText] = useState('');
            const [result, setResult] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [modelInfo, setModelInfo] = useState(null);

            useEffect(() => {
                fetch('/api/info')
                    .then(res => res.json())
                    .then(data => setModelInfo(data))
                    .catch(err => console.log('Could not fetch model info'));
            }, []);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!text.trim()) return;

                setLoading(true);
                setError(null);

                try {
                    const response = await fetch('/api/predict', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text: text })
                    });

                    if (!response.ok) {
                        throw new Error('Prediction failed');
                    }

                    const data = await response.json();
                    setResult(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            const exampleTexts = [
                "A szerződés felmondása írásban történik.",
                "Az adásvételi szerződés érvényességéhez a felek egybehangzó akaratnyilatkozata szükséges, amelyet írásba kell foglalni.",
                "A Ptk. 6:519. § alapján az adós késedelme esetén a jogosult követelheti a teljesítést, és a késedelemből eredő kárának megtérítését."
            ];

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <header className="border-b border-neutral-200 py-6 px-4">
                        <div className="max-w-3xl mx-auto">
                            <h1 className="text-xl font-semibold tracking-tight">
                                legal-text-analyzer
                            </h1>
                            <p className="text-neutral-500 text-sm mt-1">
                                Hungarian legal text understandability classification
                            </p>
                            {modelInfo && (
                                <div className="mt-3 flex gap-3 text-xs text-neutral-500">
                                    <span className="border border-neutral-200 px-2 py-1">
                                        {modelInfo.model_type}
                                    </span>
                                    <span className="border border-neutral-200 px-2 py-1">
                                        {modelInfo.parameters.toLocaleString()} params
                                    </span>
                                    {modelInfo.use_coral && (
                                        <span className="border border-neutral-200 px-2 py-1">
                                            CORAL
                                        </span>
                                    )}
                                </div>
                            )}
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-3xl mx-auto px-4 py-8">
                        {/* Input Form */}
                        <div className="border border-neutral-200 p-6 mb-6">
                            <form onSubmit={handleSubmit}>
                                <label className="block text-sm font-medium mb-2 text-neutral-600">
                                    INPUT_TEXT
                                </label>
                                <textarea
                                    value={text}
                                    onChange={(e) => setText(e.target.value)}
                                    placeholder="Paste legal text here..."
                                    className="w-full h-40 p-4 border border-neutral-200 font-mono text-sm focus:outline-none focus:border-neutral-400 resize-none bg-neutral-50"
                                />
                                
                                <div className="mt-4 flex justify-between items-center">
                                    <div className="text-xs text-neutral-400">
                                        {text.length} chars
                                    </div>
                                    <button
                                        type="submit"
                                        disabled={loading || !text.trim()}
                                        className="px-4 py-2 bg-neutral-900 text-white text-sm font-medium hover:bg-neutral-700 disabled:opacity-30 disabled:cursor-not-allowed transition-colors"
                                    >
                                        {loading ? 'ANALYZING...' : 'ANALYZE'}
                                    </button>
                                </div>
                            </form>

                            {/* Example Texts */}
                            <div className="mt-6 pt-4 border-t border-neutral-100">
                                <p className="text-xs text-neutral-400 mb-2 uppercase tracking-wider">Examples</p>
                                <div className="flex flex-wrap gap-2">
                                    {exampleTexts.map((example, i) => (
                                        <button
                                            key={i}
                                            onClick={() => setText(example)}
                                            className="px-2 py-1 text-xs border border-neutral-200 hover:bg-neutral-100 text-neutral-600 transition-colors"
                                        >
                                            example_{i + 1}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Error */}
                        {error && (
                            <div className="border border-neutral-400 bg-neutral-100 text-neutral-700 px-4 py-3 mb-6 text-sm">
                                ERROR: {error}
                            </div>
                        )}

                        {/* Results */}
                        {result && (
                            <div className="border border-neutral-200 p-6">
                                <p className="text-xs text-neutral-400 uppercase tracking-wider mb-4">
                                    RESULT
                                </p>

                                {/* Main Prediction */}
                                <div className="flex items-baseline gap-4 mb-6 pb-6 border-b border-neutral-100">
                                    <div className="text-4xl font-bold text-neutral-900">
                                        {result.prediction.charAt(0)}
                                    </div>
                                    <div>
                                        <div className="text-lg font-medium">
                                            {LABEL_SHORT[result.prediction]}
                                        </div>
                                        <div className="text-sm text-neutral-500">
                                            {(result.confidence * 100).toFixed(1)}% confidence
                                        </div>
                                    </div>
                                </div>

                                {/* Probability Distribution */}
                                <div className="space-y-2">
                                    <p className="text-xs text-neutral-400 uppercase tracking-wider mb-3">
                                        CLASS_PROBABILITIES
                                    </p>
                                    {Object.entries(result.class_probabilities).map(([label, prob]) => (
                                        <div key={label} className="flex items-center gap-3">
                                            <div className="w-20 text-xs text-neutral-500 font-medium">
                                                {LABEL_SHORT[label].split(' - ')[0]}
                                            </div>
                                            <div className="flex-1 h-4 bg-neutral-100 overflow-hidden">
                                                <div
                                                    className={`h-full prediction-bar ${label === result.prediction ? 'bg-neutral-900' : 'bg-neutral-400'}`}
                                                    style={{ width: `${prob * 100}%` }}
                                                />
                                            </div>
                                            <div className="w-12 text-xs text-right text-neutral-500 font-medium">
                                                {(prob * 100).toFixed(1)}%
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Footer */}
                    <footer className="max-w-3xl mx-auto px-4 py-8 text-center text-neutral-400 text-xs border-t border-neutral-100">
                        VITMMA19 Deep Learning Project — Legal Text Decoder
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
